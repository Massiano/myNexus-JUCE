name: Delete All Workflow Runs
on:
  workflow_dispatch:
jobs:
  delete-runs:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read
    steps:
      - name: Delete workflow runs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
          CURRENT_RUN: ${{ github.run_id }}
        run: |
          gh run list --repo $REPO --limit 1000 --json databaseId --jq '.[].databaseId' | while read -r id; do
            if [ "$id" != "$CURRENT_RUN" ]; then
              gh run delete "$id" --repo $REPO || true
            fi
          done
